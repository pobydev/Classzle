{
  "meta": {
    "project": "Classzle Smart Classroom Assigner",
    "date": "2025-12-22",
    "prepared_by": "Generated by Software Development Manager"
  },
  "product_overview": "Classzle is a Windows desktop application designed to smartly and fairly assign students into classes considering academic scores, behavior types, gender balance, and custom constraints. It balances class compositions with advanced grouping, constraint management, and flexible manual adjustment, preserving data locally for security and iterative optimization.",
  "core_goals": [
    "Balance student distribution across multiple classes based on academic score, gender, and behavioral traits.",
    "Allow teachers to create and manage custom groups for balanced dispersion (e.g., sports team, special programs).",
    "Enable complex constraints like fixed assignments, avoid or keep relationships between students.",
    "Provide a flexible workflow supporting continuous optimization and manual adjustments.",
    "Ensure privacy by running entirely locally with no external data communication.",
    "Support persistent project saving/loading and exporting/importing via Excel files with rich formatting."
  ],
  "key_features": [
    "Excel import parsing of student data supporting multiple formats with behavior, prior class, and group info.",
    "Main algorithm that assigns students balancing academic scores in a zigzag (S-shaped) pattern and respecting constraints.",
    "Custom group management for balanced group distribution.",
    "Constraint handling: fixed assignments, avoid relationships (separation), keep relationships (pairing).",
    "Support for pre-transfer (transfer out) students balancing gender and placement.",
    "Interactive drag-and-drop UI for manual student assignment and swaps with validation.",
    "Project persistency with save/load functionality implemented via Zustand and Electron native dialogs.",
    "Dashboard showing per-class summary statistics: average score, gender ratio, behavior totals.",
    "Export assigned classes and previous classes to a formatted Excel file with two sheets.",
    "Assignment reports including constraint fulfillment, move history with timestamps, and print preview support."
  ],
  "user_flow_summary": [
    "Step 1: Setup - User sets the number of classes, uploads an Excel file with student data, and optionally modifies student details inline.",
    "Step 2: Constraints & Groups - User creates and tags custom groups, sets avoid/keep relationships, fixed class assignments, and marks pre-transfer students.",
    "Step 3: Assignment & Dashboard - User executes assignment (new or optimize) with visual board per class, uses filters and drag-and-drop to adjust assignments, views detailed statistics and reports, and exports results.",
    "Save/Load - User can save the current project state to a local JSON file and reload it any time.",
    "Excel Export - User exports final assignment results into Excel files with two stylized sheets for class and prior class views."
  ],
  "validation_criteria": [
    "Successful parsing and validation of uploaded Excel files according to schema requirements.",
    "Assignment algorithm produces balanced class distributions with minimal constraint violations.",
    "UI allows stable drag-and-drop and inline editing without data corruption.",
    "Constraint validation prevents invalid student swaps and flags violations accurately.",
    "Project save and load restore all user information and assignment states completely.",
    "Exported Excel files match formatting specifications including headers, summaries, and pagination.",
    "Reports accurately reflect current assignment state, constraint fulfillment rates, and recent changes.",
    "Application runs entirely locally with no external data leaks.",
    "Persisted state is consistent across app restarts."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "Next.js 16",
      "React 19",
      "Electron 33",
      "Zustand 5",
      "Tailwind CSS 4",
      "ExcelJS",
      "xlsx"
    ],
    "features": [
      {
        "name": "parseExcelFile",
        "description": "Parse student data from Excel file, extracting name, gender, academic score, behavior type/score, and class assignment info",
        "files": [
          "src/lib/excel.ts"
        ],
        "api_doc": {
          "function": "parseExcelFile",
          "input": "File (Excel .xlsx)",
          "output": "Promise<Student[]>",
          "throws": "Error on parsing failure"
        }
      },
      {
        "name": "loadProject",
        "description": "Load saved project data (students, groups, settings) from JSON into Zustand store",
        "files": [
          "src/lib/store.ts"
        ],
        "api_doc": {
          "function": "loadProject",
          "input": "{ students: Student[], groups: CustomGroup[], settings: AppSettings }",
          "output": "void",
          "sideEffects": "Updates Zustand store state"
        }
      },
      {
        "name": "assignStudents",
        "description": "Main algorithm to assign students to classes with balanced distribution considering academic scores, behavior types, gender, and constraints (avoid/keep/fixed)",
        "files": [
          "src/lib/algorithm.ts"
        ],
        "api_doc": {
          "function": "assignStudents",
          "input": "students: Student[], classCount: number, groups: CustomGroup[], scoreTolerance: number, mode: 'new' | 'optimize', useAdvancedConstraints: boolean",
          "output": "{ students: Student[], violations: Violation[] }"
        }
      },
      {
        "name": "exportToExcel",
        "description": "Export assigned students to formatted Excel file with two sheets (by assigned class, by previous class)",
        "files": [
          "src/lib/excel.ts"
        ],
        "api_doc": {
          "function": "exportToExcel",
          "input": "students: Student[], classCount: number, filename: string, options: { includeDetails?, groups?, numberingMethod? }",
          "output": "Promise<void>",
          "sideEffects": "Downloads Excel file"
        }
      },
      {
        "name": "validateSwap",
        "description": "Validate if swapping two students would violate any constraints (fixed class, avoid relations, keep relations)",
        "files": [
          "src/lib/validation.ts"
        ],
        "api_doc": {
          "function": "validateSwap",
          "input": "studentId1: string, studentId2: string, allStudents: Student[]",
          "output": "Violation[]"
        }
      }
    ]
  }
}
